<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COVID-19 Vaccine Timeline</title>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-core.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-timeline.min.js"></script>
    <style>
        html, body, #container {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>

    <div id="container"></div>

    <script>
        anychart.onDocumentReady(function () {
            fetch('vaccine_timeline.json')
                .then(response => response.json())
                .then(data => {
                    // Create the chart
                    var chart = anychart.timeline();

                    // Process Pfizer Timeline (Ranges)
                    var pfizerRangeData = data.pfizerTimeline.map(item => {
                        return {
                            name: item.title,
                            start: new Date(item.start),
                            end: new Date(item.end),
                            description: item.description,
                            fill: item.color,
                            stroke: item.color
                        };
                    });
                    var rangeSeries = chart.range(pfizerRangeData);
                    rangeSeries.name("Pfizer Timeline");

                     // Configure tooltip for ranges
                    rangeSeries.tooltip().useHtml(true);
                    rangeSeries.tooltip().format(function() {
                        var start = anychart.format.dateTime(this.start, "dd MMM yyyy");
                        var end = anychart.format.dateTime(this.end, "dd MMM yyyy");
                        return "<span style='font-weight:600;font-size:12pt'>" +
                               this.getData("name") + "</span>" +
                               "<br><br>Dates: " + start + " - " + end +
                               "<br>" + this.getData("description");
                    });


                    // Process Pfizer Facts (Moments)
                    var pfizerMomentData = data.pfizerFacts.map(item => {
                        return {
                            x: new Date(item.date),
                            y: item.title,
                            description: item.description
                        };
                    });
                    var momentSeries1 = chart.moment(pfizerMomentData);
                    momentSeries1.name("Pfizer Facts");
                    momentSeries1.normal().markers().fill("#007bff");
                    momentSeries1.normal().markers().stroke("#0056b3");

                    // Process Other Vaccines (Moments)
                    var otherMomentData = data.otherVaccines.map(item => {
                        return {
                            x: new Date(item.date),
                            y: item.title,
                            description: item.description
                        };
                    });
                    var momentSeries2 = chart.moment(otherMomentData);
                    momentSeries2.name("Other Vaccines");
                    momentSeries2.normal().markers().fill("#ffc107");
                    momentSeries2.normal().markers().stroke("#d39e00");


                    // Configure tooltips for moments
                    var momentTooltipFormat = function() {
                        var date = anychart.format.dateTime(this.x, "dd MMM yyyy");
                        return "<span style='font-weight:600;font-size:12pt'>" +
                               this.value + "</span>" +
                               "<br><br>Date: " + date +
                               "<br>" + this.getData("description");
                    };

                    momentSeries1.tooltip().useHtml(true);
                    momentSeries1.tooltip().format(momentTooltipFormat);
                    momentSeries2.tooltip().useHtml(true);
                    momentSeries2.tooltip().format(momentTooltipFormat);


                    // Add Today Marker
                    var todayMarker = chart.todayMarker();
                    todayMarker.stroke("#dd2c00", 2, "5 2");

                    // Add Year Markers
                    // Calculate year range from data
                    var allItems = [];
                    if (data.pfizerTimeline) allItems = allItems.concat(data.pfizerTimeline);
                    if (data.pfizerFacts) allItems = allItems.concat(data.pfizerFacts);
                    if (data.otherVaccines) allItems = allItems.concat(data.otherVaccines);

                    var minTs = Date.now();
                    var maxTs = Date.now();

                    allItems.forEach(item => {
                        var dates = [];
                        if (item.date) dates.push(new Date(item.date));
                        if (item.start) dates.push(new Date(item.start));
                        if (item.end) dates.push(new Date(item.end));

                        dates.forEach(d => {
                            if (!isNaN(d.getTime())) {
                                if (d.getTime() < minTs) minTs = d.getTime();
                                if (d.getTime() > maxTs) maxTs = d.getTime();
                            }
                        });
                    });

                    var startYear = new Date(minTs).getFullYear();
                    var endYear = new Date(maxTs).getFullYear();

                    var markerIndex = 0;
                    for (var y = startYear; y <= endYear; y++) {
                        var lineMarker = chart.lineMarker(markerIndex);
                        lineMarker.value(new Date(y, 0, 1));
                        lineMarker.stroke("#555", 2, "5 2");

                        var textMarker = chart.textMarker(markerIndex);
                        textMarker.value(new Date(y, 0, 1));
                        textMarker.text(y.toString());
                        textMarker.fontSize(20);
                        textMarker.fontColor("#555");
                        textMarker.fontWeight("bold");
                        textMarker.anchor("left-top");
                        textMarker.padding(5);

                        markerIndex++;
                    }


                    // Set chart container and draw
                    chart.container("container");
                    chart.draw();

                    // Zoom to fit the data
                    chart.fit();
                })
                .catch(error => console.error('Error loading data:', error));
        });
    </script>

</body>
</html>
